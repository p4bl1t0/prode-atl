<!DOCTYPE html>
<html>
    <head>
        <title>Prode Autologico</title>
        <meta charset="utf-8" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css" />
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
            <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">
        <!--<![endif]-->
        <link rel="stylesheet" href="css/app.css" />
    </head>
    <body>
        <div class="header">
            <div class="home-menu pure-menu pure-menu-open pure-menu-horizontal">
                <a href="#" class="pure-menu-heading">Prode Autologico</a>
                <ul>
                    <li class="pure-menu-selected"><a href="#">Home</a></li>
                </ul>
            </div>
        </div>
        <div class="content">
            <div class="pure-g">
                <div class="pure-u-1 pure-u-md-1-3">
                    <div id="placeholder-partidos"></div>
                </div>
                <div class="pure-u-1 pure-u-md-2-3">
                    <h2>Ranking del prode</h2>
                    <div id="placeholder-ranking"></div>
                </div>
            </div>
            
        </div>	   
	   <div style="display:none">
			<div class="large-6 columns" id="tpl_todays_matches">
				<h2>Partidos de hoy</h2>
			</div>
	   </div>   
       <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
       <script src="jquery.tablesorter.min.js"></script>
       <script>
	    $(document).ready(function() { //
            //var baseURL = "http://prode.127.0.0.1.xip.io";
            var baseURL = "http://prode.162.243.6.106.xip.io";
			var timeRefreshResults = 5000;
            var _table = null;
            $.ajax({
                url: baseURL + "/getter.php?grupo=Grupo ATL ROJO"
            }).done(function (result) {
                var _html = $(result);
                _table = _html.find("table");
                $.ajax({
                    url: baseURL + "/getter.php?grupo=Grupo ATL Verde"
                }).done(function (result) {
                    var _html = $(result);
                    _table.find("tbody").append(_html.find("table").find("tr:not(:first)"));
                    $.ajax({
                        url: baseURL + "/getter.php?grupo=Grupo ATL Negro"
                    }).done(function (result) {
                        var _html = $(result);
                        _table.addClass("pure-table pure-table-bordered table-ranking").removeAttr("align").removeAttr("width");
                        _table.find("tbody").append(_html.find("table").find("tr:not(:first)"));
                        _table.prepend($("<thead>").append(_table.find("tr:first")));
                        //_table.find("tbody tr:first").remove();
                        _table.find("tr").each(function(){ $(this).find("td:first").remove(); });
                        _table.find("tr").removeAttr("bgColor");
                        $("#placeholder-ranking").append(_table).find("table").tablesorter({sortList: [[1,1],[0,0]]})
                        
                    });
                });
            });
			
			getDataMatches();
			
			
			var $placeholder = $("#placeholder-partidos");
			var $tpl_today_matches = $("#tpl_todays_matches");
			
			
			var $clone;
			function getDataMatches(){
				if($clone != undefined){ $clone.addClass("load"); }
				$.ajax({
					url:"http://worldcup.sfg.io/matches/today",
					dataType: "json"
				}).done(
					function(result){
						if(result.length>0){
							$placeholder.find("#todays").remove();
							$clone = $tpl_today_matches.clone().attr("id","todays");
							for(var par in result){
								var $p =$("<p>");
								var d = new Date(result[par].datetime);
								var status ="";
								status = (result[par].status != "future") ? "<strong>Finalizado<strong>" : "";
								$p.addClass("match-results").html(result[par].home_team.country + " (" + result[par].home_team.goals + ")  VS  " + result[par].away_team.country + " (" + result[par].away_team.goals + ") [ " + d.getHours() + "hs" +" ] " + status );
								$clone.append($p);
								$placeholder.prepend($clone);
							}
							$clone.removeClass("load");
						}
					}
				);
				
				
			}
			
			//tomorrow's matches
			$.ajax({
				url:"http://worldcup.sfg.io/matches/tomorrow",
				dataType: "json"
			}).done(
				function(result){
					if(result.length>0){
						$placeholder.find("#todays").remove();
						$clone = $tpl_today_matches.clone().attr("id","tomorrow");
						$clone.find("h2").html("Partidos de ma√±ana");
						for(var par in result){
							var $p =$("<p>");
							var d = new Date(result[par].datetime);
							$p.addClass("match-results").html(result[par].home_team.country + " (" + result[par].home_team.goals + ")  VS  " + result[par].away_team.country + " (" + result[par].away_team.goals + ") [ " +  d.getHours() + "hs" +" ]");
							$clone.append($p);
							$placeholder.append($clone);
						}
						
					}
				}
			);
			
			
			var interval = setInterval(function(){getDataMatches();}, timeRefreshResults);
         });
       </script>
    </body>
</html>